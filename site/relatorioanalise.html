<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inserir Dados do Relatório</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../stylesheets/base.css?v=1.0.0">
    <link rel="stylesheet" href="../stylesheets/themes/dark-theme-modal.css">
    <style>
        html, body { height: 100%; margin: 0; padding: 0; }
        body { padding: 20px; background-color: #f8f9fa; display: flex; flex-direction: column; }
        .form-group { flex-grow: 1; display: flex; flex-direction: column; }
        #rtfContent { flex-grow: 1; }
        .btn-container { margin-top: 15px; text-align: right; }
    </style>
</head>
<body>
    <h4>Dados para Relatório de Análise</h4>
    <p class="text-muted">Cole o conteúdo do arquivo .rtf no campo abaixo e clique em "Inserir".</p>
    
    <div class="form-group">
        <label for="rtfContent"><b>Conteúdo do Relatório:</b></label>
        <textarea id="rtfContent" class="form-control" placeholder="Banco de dados analisado: ..."></textarea>
    </div>

    <div class="btn-container">
        <button onclick="closeDialog()" class="btn btn-secondary">Cancelar</button>
        <button onclick="inserirTextoNoEditor()" class="btn btn-primary">Inserir no Editor</button>
    </div>
    <script src="../scripts/app.js"></script>
    <script>
        function closeDialog() {
            // Acessa o window manager do editor ativo na janela pai e fecha o diálogo atual (o topo da pilha)
            if (window.parent && window.parent.tinymce) {
                window.parent.tinymce.activeEditor.windowManager.close();
            } else {
                // Fallback caso não encontre o editor
                window.close();
            }
        }

        function inserirTextoNoEditor() {
            const text = document.getElementById('rtfContent').value;
            
            if (window.parent && typeof window.parent.handleRelatorioData === 'function') {
                // Chama a função de callback na janela pai, passando o texto
                window.parent.handleRelatorioData(text);
                
                if (text.trim() != null && text.trim())
                    // Fecha o modal após enviar os dados
                    closeDialog();
            } else {
                alert('Erro: Não foi possível comunicar com o editor principal. A janela pode ter sido fechada.');
            }
        }

        document.getElementById('btn-gerar-relatorio').addEventListener('click', gerarRelatorioAnalise);

        function gerarRelatorioAnalise() {
            const tipo = document.getElementById('tipo').value;
            const url = document.getElementById('url').value;
            const motivo = document.getElementById('motivo').value;
            const resultado = `Prezados, boa tarde! Segue o resultado da análise de ${tipo} com a URL/ID ${url}. Motivo: ${motivo}.`;
            document.getElementById('resultado-relatorio').value = resultado;
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', applyModalTheme);
    </script>
</body>
</html>


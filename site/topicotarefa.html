<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Tópicos de Tarefa</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../stylesheets/style.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            display: flex;
            flex-direction: column;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 15px;
        }
        .footer-content {
            flex-shrink: 0;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
            text-align: right; /* Alinhamento alterado para a direita */
        }
        .btn { 
            margin-left: 8px; /* Espaçamento ajustado para a esquerda de cada botão */
        }
        .form-section { border: 1px solid #dee2e6; border-radius: 5px; padding: 20px; margin-bottom: 15px; background-color: #fff; }
    </style>
</head>
<body>
    <!-- Cabeçalho Fixo -->
    <div>
        <h4>Gerador de Tópicos de Tarefa</h4>
        <p class="text-muted">Preencha os campos para gerar o tópico formatado em HTML.</p>
    </div>

    <!-- Área de Conteúdo Rolável -->
    <div class="main-content">
        <div class="form-section">
            <div class="form-row">
                <div class="form-group col-md-3">
                    <label for="numeroTarefa"><b>Nº da Tarefa:</b></label>
                    <input type="number" id="numeroTarefa" class="form-control" required placeholder="Ex: 12345">
                </div>
                <div class="form-group col-md-9">
                    <label for="tituloTopicoSelect"><b>Título do Tópico:</b></label>
                    <select id="tituloTopicoSelect" class="form-control">
                        <option value="ACOMPANHAMENTO IMP">ACOMPANHAMENTO IMP</option>
                        <option value="ANÁLISE">ANÁLISE</option>
                        <option value="ACERTO COMERCIAL">ACERTO COMERCIAL</option>
                        <option value="BACKUP">BACKUP</option>
                        <option value="CONFECÇÃO DE MINUTAS NOTAS">CONFECÇÃO DE MINUTAS NOTAS</option>
                        <option value="CONFECÇÃO DE MINUTAS RCPN">CONFECÇÃO DE MINUTAS RCPN</option>
                        <option value="CONFIGURAÇÃO">CONFIGURAÇÃO</option>
                        <option value="CREDENCIAIS AWS">CREDENCIAIS AWS</option>
                        <option value="DATA DA IMPLANTAÇÃO/ATIVAÇÃO">DATA DA IMPLANTAÇÃO/ATIVAÇÃO</option>
                        <option value="DESENVOLVIMENTO E VALIDAÇÃO">DESENVOLVIMENTO E VALIDAÇÃO</option>
                        <option value="GARANTIA">GARANTIA</option>
                        <option value="INSTALAÇÃO">INSTALAÇÃO</option>
                        <option value="INSTALAÇÃO/CONFIGURAÇÃO/TREINAMENTO">INSTALAÇÃO/CONFIGURAÇÃO/TREINAMENTO</option>
                        <option value="KEY USER (USUÁRIO-CHAVE)">KEY USER (USUÁRIO-CHAVE)</option>
                        <option value="LIBERAÇÃO AO SUPORTE TÉCNICO">LIBERAÇÃO AO SUPORTE TÉCNICO</option>
                        <option value="MIGRAÇÃO">MIGRAÇÃO</option>
                        <option value="OUTRAS INFORMAÇÕES">OUTRAS INFORMAÇÕES</option>
                        <option value="RELATO VISITA TÉCNICA">RELATO VISITA TÉCNICA</option>
                        <option value="TAXA DE SUCESSO">TAXA DE SUCESSO</option>
                        <option value="TREINAMENTO">TREINAMENTO</option>
                        <option value="TROCA P/ PLUG VIRTUAL">TROCA P/ PLUG VIRTUAL</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="form-section">
             <div class="form-check">
                <input type="checkbox" class="form-check-input" id="osAssociada" onchange="TemNumeroOS()">
                <label class="form-check-label" for="osAssociada"><b>Tem OS Associada?</b></label>
            </div>
            <div class="form-group mt-3" id="divNumeroOS" style="display: none;">
                <label for="numeroOS"><b>Nº da OS:</b></label>
                <input type="number" id="numeroOS" class="form-control" style="max-width: 200px;">
            </div>
        </div>

        <div class="form-group">
            <label for="codigoHTML"><b>Código HTML Gerado:</b></label>
            <textarea id="codigoHTML" class="form-control" rows="5" readonly></textarea>
        </div>
    </div> 

    <!-- Rodapé Fixo com Botões -->
    <div class="footer-content">
        <button onclick="cancelarAcao()" class="btn btn-secondary">Cancelar</button>
        <button onclick="FormatarTopicoTarefa()" class="btn btn-primary">Formatar e Copiar</button>
    </div>
    
    <script>
        function TemNumeroOS() {
            const checkbox = document.getElementById("osAssociada");
            const divNumeroOS = document.getElementById("divNumeroOS");
            divNumeroOS.style.display = checkbox.checked ? "block" : "none";
        }

        function cancelarAcao() {
            // Envia uma mensagem para a janela pai (o editor) para fechar o modal
            var top = window.parent;
            top.postMessage({ mceAction: 'close' }, '*');
        }
        
        function FormatarTopicoTarefa() {
            const numeroTarefa = document.getElementById("numeroTarefa").value;
            const tituloTopico = document.getElementById("tituloTopicoSelect").value;
            const osAssociada = document.getElementById("osAssociada").checked;
            const numeroOS = document.getElementById("numeroOS").value.trim();
            const today = new Date();
            const dd = String(today.getDate()).padStart(2, '0');
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const yyyy = today.getFullYear();
            const formattedDate = dd + '/' + mm + '/' + yyyy;

            if (!numeroTarefa) {
                alert("O campo 'Nº da Tarefa' é obrigatório.");
                return;
            }
            if (osAssociada && !numeroOS) {
                alert("Se a OS está associada, seu número é obrigatório.");
                return;
            }

            let codigoHTML = '';
            if (osAssociada) {
                const osLink = `<a href="https://www.sacdemaria.com.br/adm/os/consulta_os.php?id=${numeroOS}" target="_blank"><u>OS ${numeroOS}</u></a>`;
                const titlePart = tituloTopico === "DATA DA IMPLANTAÇÃO/ATIVAÇÃO" ? `: ${formattedDate}` : "";
                codigoHTML = `<p><big><b>${numeroTarefa}) ${tituloTopico}${titlePart}</b> - Ver ${osLink}</big></p>`;
            } else {
                if (tituloTopico === "DATA DA IMPLANTAÇÃO/ATIVAÇÃO") {
                    codigoHTML = `<p><big><b>${numeroTarefa}) ${tituloTopico}:</b> ${formattedDate}</big></p>`;
                } else if (tituloTopico === "GARANTIA") {
                    const dataGarantia = new Date();
                    dataGarantia.setDate(dataGarantia.getDate() + 90);
                    const ddGarantia = String(dataGarantia.getDate()).padStart(2, '0');
                    const mmGarantia = String(dataGarantia.getMonth() + 1).padStart(2, '0');
                    const yyyyGarantia = dataGarantia.getFullYear();
                    const formattedGarantia = ddGarantia + '/' + mmGarantia + '/' + yyyyGarantia;
                    codigoHTML = `<p><big><b>${numeroTarefa}) ${tituloTopico}</b> - Até ${formattedGarantia}</big></p>`;
                } else {
                    codigoHTML = `<p><big><b>${numeroTarefa}) ${tituloTopico}</b></big></p>`;
                }
            }
            
            const textArea = document.getElementById("codigoHTML");
            textArea.value = codigoHTML;

            // Copia o resultado para a área de transferência
            if (textArea.value) {
                textArea.select();
                document.execCommand('copy');
            }
        }

        document.getElementById('btn-gerar-topico-tarefa').addEventListener('click', gerarTopicoTarefa);

        function gerarTopicoTarefa() {
            const numeroTarefa = document.getElementById('numero-tarefa').value;
            const titulo = document.getElementById('titulo-tarefa').value;
            const resultado = `[TAREFA-${numeroTarefa}] ${titulo}`;
            document.getElementById('resultado-topico-tarefa').value = resultado;
  }
    </script>
</body>
</html>
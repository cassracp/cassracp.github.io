<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Tópicos de OS</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="../stylesheets/base.css?v=1.0.0">
    <link rel="stylesheet" href="../stylesheets/themes/dark-theme-modal.css">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            display: flex;
            flex-direction: column;
            padding: 20px;
            background-color: #f8f9fa;
        }
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
            padding: 5px;
        }
        .footer-content {
            flex-shrink: 0;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
            text-align: right; /* Alinhamento à direita */
        }
        .btn { 
            margin-left: 8px; 
        }
        .form-section { 
            border: 1px solid #dee2e6; 
            border-radius: 5px; 
            padding: 20px; 
            margin-bottom: 15px; 
            background-color: #fff; 
        }
        .checkbox-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
    </style>
</head>
<body>
    <!-- Cabeçalho Fixo -->
    <div>
        <h4>Gerador de Tópicos de OS</h4>
        <p class="text-muted">Preencha os campos para gerar o tópico da Ordem de Serviço.</p>
    </div>

    <!-- Área de Conteúdo Rolável -->
    <div class="main-content">
        <div class="form-section">
            <div class="form-row">
                 <div class="form-group col-md-4">
                    <label for="numeroTarefa"><b>Nº Tarefa:</b></label>
                    <input type="number" id="numeroTarefa" class="form-control" required>
                </div>
                <div class="form-group col-md-8">
                    <label for="assuntoTopicoSelect"><b>Assunto do Tópico:</b></label>
                    <select id="assuntoTopicoSelect" class="form-control">
                        <option value="CN">CN - Cliente Novo</option>
                        <option value="MIG">MIG - Migração</option>
                        <option value="NM">NM - Novo Módulo</option>
                        <option value="TT">TT - Troca de Titularidade</option>
                        <option value="OUTRO">Outro (especifique)</option>
                    </select>
                    <input type="text" id="assuntoTopicoInput" class="form-control mt-2" style="display: none;" placeholder="Digite a abreviatura do assunto (ex.: CN)">
                </div>
            </div>
        </div>

        <div class="form-section">
            <h6>Título do Tópico</h6>
            <div class="checkbox-grid">
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkInstal" value="Instalação"><label class="form-check-label" for="chkInstal">Instalação</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkConfig" value="Configuração"><label class="form-check-label" for="chkConfig">Configuração</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkTrn" value="Treinamento"><label class="form-check-label" for="chkTrn">Treinamento</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkDesenv" value="Desenvolvimento"><label class="form-check-label" for="chkDesenv">Desenvolvimento</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkValid" value="Validação"><label class="form-check-label" for="chkValid">Validação</label></div>
            </div>
        </div>

        <div class="form-section">
            <h6>Módulos Contratados</h6>
            <div class="checkbox-grid">
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkNascimento" value="N"><label class="form-check-label" for="chkNascimento">Nascimento</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkCasamento" value="C"><label class="form-check-label" for="chkCasamento">Casamento</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkObito" value="O"><label class="form-check-label" for="chkObito">Óbito</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkLivroE" value="E"><label class="form-check-label" for="chkLivroE">Livro E</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkComunica" value="A"><label class="form-check-label" for="chkComunica">Comunicações</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkAverba" value="V"><label class="form-check-label" for="chkAverba">Averbações</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkSelagem" value="S"><label class="form-check-label" for="chkSelagem">Selagem</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkFirmas" value="F"><label class="form-check-label" for="chkFirmas">Firmas</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkFinanceiro" value="U"><label class="form-check-label" for="chkFinanceiro">Financeiro</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkINotas" value="pr"><label class="form-check-label" for="chkINotas">i-Notas</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkEscrituras" value="R"><label class="form-check-label" for="chkEscrituras">Escrituras Plus</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkProc" value="P"><label class="form-check-label" for="chkProc">Procurações Plus</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkBkp" value="K"><label class="form-check-label" for="chkBkp">Backup em Nuvem</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkPol" value="X"><label class="form-check-label" for="chkPol">POL - Proclamas Online</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkUI" value="I"><label class="form-check-label" for="chkUI">UI - Unidade Interligada</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkAol" value=" AOL"><label class="form-check-label" for="chkAol">AOL - Atendimento Online</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkDOCFila" value="Q"><label class="form-check-label" for="chkDOCFila">DOC-Fila</label></div>
                <div class="form-check"><input type="checkbox" class="form-check-input" id="chkDOCMultiscan" value="M"><label class="form-check-label" for="chkDOCMultiscan">DOC-Multiscan</label></div>
            </div>
        </div>
        
        <div class="form-section">
            <h6>Sistema</h6>
            <div class="form-check form-check-inline"><input type="checkbox" class="form-check-input" id="chkWindows" value="w" checked="true"><label class="form-check-label" for="chkWindows">DOC-Windows</label></div>
            <div class="form-check form-check-inline"><input type="checkbox" class="form-check-input" id="chkWeb" value="W"><label class="form-check-label" for="chkWeb">DOC-Web</label></div>
        </div>

        <div class="form-group">
            <label for="topicoFormatado"><b>Tópico Formatado:</b></label>
            <textarea id="topicoFormatado" class="form-control" rows="4" readonly></textarea>
        </div>
    </div> 

    <!-- Rodapé Fixo com Botões -->
    <div class="footer-content">
        <button onclick="cancelarAcao()" class="btn btn-secondary">Cancelar</button>
        <button onclick="FormatarTopicoOS()" class="btn btn-primary">Formatar e Copiar</button>
    </div>
    <script src="../scripts/app.js"></script>
    <script>
        document.getElementById("assuntoTopicoSelect").addEventListener("change", function() {
            const select = this;
            const input = document.getElementById("assuntoTopicoInput");
            if (select.value === "OUTRO") {
                select.style.display = "none";
                input.style.display = "block";
                input.focus();
            }
        });

        document.getElementById("assuntoTopicoInput").addEventListener("blur", function() {
            const input = this;
            const select = document.getElementById("assuntoTopicoSelect");
            if (input.value.trim() === "") {
                input.style.display = "none";
                select.style.display = "block";
                select.value = "CN";
            }
        });

        function cancelarAcao() {
            var top = window.parent;
            top.postMessage({ mceAction: 'close' }, '*');
        }

        function FormatarTopicoOS() {
            const numeroTarefa = document.getElementById("numeroTarefa").value.trim();
            const selectAssunto = document.getElementById("assuntoTopicoSelect");
            const inputAssunto = document.getElementById("assuntoTopicoInput");
            
            if (!numeroTarefa) {
                alert("O campo 'Nº Tarefa' é obrigatório.");
                return;
            }

            let assuntoTopico = selectAssunto.value === "OUTRO" ? inputAssunto.value.trim() : selectAssunto.value;
            if (selectAssunto.value === "OUTRO" && !assuntoTopico) {
                alert("Por favor, especifique o assunto 'Outro'.");
                return;
            }

            const titulos = ['Instal', 'Config', 'Trn', 'Desenv', 'Valid']
                .map(id => document.getElementById(`chk${id}`))
                .filter(chk => chk.checked)
                .map(chk => chk.value);

            if (titulos.length === 0) {
                alert("Você deve selecionar pelo menos um Título do Tópico (Instalação, Configuração, etc.).");
                return;
            }
            
            const modulosIds = ['Nascimento', 'Casamento', 'Obito', 'LivroE', 'Comunica', 'Averba', 'Selagem', 'Firmas', 'Financeiro', 'INotas', 'Escrituras', 'Proc', 'Bkp', 'Pol', 'UI', 'Aol', 'DOCFila', 'DOCMultiscan'];
            const modulos = modulosIds
                .map(id => document.getElementById(`chk${id}`))
                .filter(chk => chk.checked)
                .map(chk => chk.value.trim());

            const sistemas = ['Windows', 'Web']
                .map(id => document.getElementById(`chk${id}`))
                .filter(chk => chk.checked)
                .map(chk => chk.value);

            let modulosString = modulos.join('') + sistemas.join('');
            if (document.getElementById('chkAol').checked) {
                 modulosString = modulos.filter(m => m !== "").join('') + sistemas.join('') + ' AOL';
            }

            let txtFormatado = `${assuntoTopico}: ${titulos.join("/")}`;
            if (modulosString) {
                txtFormatado += ` [${modulosString.trim()}]`;
            }
            txtFormatado += ` - Tarefa: ${numeroTarefa}`;

            const textArea = document.getElementById("topicoFormatado");
            textArea.value = txtFormatado;

            if (textArea.value) {
                textArea.select();
                document.execCommand('copy');
            }
        }

        document.getElementById('btn-gerar-topico-os').addEventListener('click', gerarTopicoOS);

        function gerarTopicoOS() {
            const numeroOS = document.getElementById('numero-os').value;
            const titulo = document.getElementById('titulo-os').value;
            const resultado = `[OS${numeroOS}] ${titulo}`;
            document.getElementById('resultado-topico-os').value = resultado;
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', applyModalTheme);
    </script>
</body>
</html>

